{% extends 'scheduler/base.html' %}

{% block title %}Review AI Results{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-lg max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-4">Review AI Generated Content</h1>
    <p class="text-gray-600 mb-8">Please review the content generated by AI. You can confirm to proceed to the final review, or cancel to start over.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <!-- Kolom Kiri: Hasil AI Edit -->
        <div>
            <h2 class="text-xl font-semibold text-gray-700 mb-4">AI Image Edit</h2>
            {% with primary_asset=schedule.get_primary_media_asset %}
                {% if schedule.needs_ai_edit and primary_asset %}
                    <p class="mb-2 text-sm text-gray-500"><strong>Prompt:</strong> "{{ schedule.ai_edit_prompt }}"</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-medium text-center mb-2">Original</h3>
                            <img src="{{ primary_asset.file.url }}" alt="Original media" class="rounded-lg border">
                        </div>
                        <div>
                            <h3 class="font-medium text-center mb-2">AI Edited Version</h3>
                            {% if primary_asset.edited_file %}
                                <img src="{{ primary_asset.edited_file.url }}" alt="AI edited media" class="rounded-lg border border-indigo-500 ring-2 ring-indigo-200">
                            {% else %}
                                <div class="h-full flex items-center justify-center bg-gray-100 rounded-lg border">
                                    <p class="text-red-500">Edit failed.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <p class="text-gray-500 italic">No AI image editing was requested.</p>
                {% endif %}
            {% endwith %}
        </div>

        <!-- Kolom Kanan: Hasil AI Caption -->
        <div>
            <h2 class="text-xl font-semibold text-gray-700 mb-4">AI Generated Caption</h2>
            {% if schedule.needs_ai_caption %}
                <div class="p-4 bg-gray-50 rounded-md border h-full">
                    <h3 class="font-medium mb-2">Generated Caption:</h3>
                    {% if schedule.ai_generated_caption %}
                        <p class="text-gray-800 whitespace-pre-wrap">{{ schedule.ai_generated_caption }}</p>
                    {% else %}
                        <p class="text-red-500">Caption generation failed.</p>
                    {% endif %}
                    
                    <h3 class="font-medium mt-6 mb-2">Your Manual Caption (if any):</h3>
                    {% if schedule.caption %}
                        <p class="text-gray-600 whitespace-pre-wrap italic">"{{ schedule.caption }}"</p>
                        <p class="text-xs text-gray-500 mt-2">(Note: If you provided a manual caption, it will be used. The AI caption is just a suggestion.)</p>
                    {% else %}
                        <p class="text-gray-400 italic">No manual caption provided. The AI-generated caption will be used if you confirm.</p>
                    {% endif %}
                </div>
            {% else %}
                <p class="text-gray-500 italic">No AI caption generation was requested.</p>
            {% endif %}
        </div>
    </div>

    <!-- Tombol Aksi -->
    <div class="mt-8 pt-6 border-t flex justify-end items-center space-x-4">
        <!-- Tombol Cancel akan menghapus schedule ini dan kembali ke form -->
        <form action="{% url 'scheduler:delete_schedule' schedule.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="px-6 py-2 text-red-700 bg-red-100 rounded-md hover:bg-red-200">Cancel & Start Over</button>
        </form>
        <!-- Tombol Confirm akan lanjut ke final preview -->
        <a href="{% url 'scheduler:confirm_ai_result' schedule.id %}" class="px-8 py-2 font-semibold text-white bg-indigo-600 rounded-md shadow-sm hover:bg-indigo-700">
            Confirm AI Results & Proceed
        </a>
    </div>
</div>
{% endblock %}