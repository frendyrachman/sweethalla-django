{% extends 'scheduler/base.html' %}

{% block title %}Preview Schedule{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-4">Review Your Schedule</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Kolom Kiri: Detail Jadwal -->
        <div>
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Schedule Details</h2>
            <div class="space-y-3 text-gray-600">
                <p><strong>Platform:</strong> {{ schedule.get_platform_display }}</p>
                <p><strong>Media Type:</strong> {{ schedule.get_media_type_display }}</p>
                {% if schedule.content_type %}
                <p><strong>Content Type:</strong> {{ schedule.get_content_type_display }}</p>
                {% endif %}
                <p><strong>Schedule Time:</strong> {{ schedule.schedule_time|date:"d M Y, H:i" }}</p>
            </div>

            <h2 class="text-xl font-semibold text-gray-700 mt-6 mb-4">AI Processing</h2>
            <div class="space-y-3 text-gray-600">
                <p><strong>AI Edit Needed:</strong> {% if schedule.needs_ai_edit %}Yes{% else %}No{% endif %}</p>
                {% if schedule.needs_ai_edit %}
                <p class="pl-4 border-l-2"><strong>Prompt:</strong> "{{ schedule.ai_edit_prompt }}"</p>
                {% endif %}
                <p><strong>AI Caption Needed:</strong> {% if schedule.needs_ai_caption %}Yes{% else %}No{% endif %}</p>
            </div>

            <h2 class="text-xl font-semibold text-gray-700 mt-6 mb-4">Caption</h2>
            <div class="p-4 bg-gray-50 rounded-md border text-gray-700 whitespace-pre-wrap">
                {% if schedule.caption %}
                    {{ schedule.caption }}
                {% else %}
                    <span class="text-gray-400 italic">
                        {% if schedule.needs_ai_caption %}
                        Caption will be generated by AI.
                        {% else %}
                        No caption provided.
                        {% endif %}
                    </span>
                {% endif %}
            </div>
        </div>

        <!-- Kolom Kanan: Pratinjau Media -->
        <div>
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Media Preview</h2>
            <div class="space-y-4">
                {% for asset in schedule.media_assets.all %}
                    <div class="border rounded-lg overflow-hidden">
                        {% if 'image' in asset.file.url|lower %}
                            <img src="{{ asset.file.url }}" alt="Media preview {{ forloop.counter }}" class="w-full h-auto object-cover">
                        {% elif 'video' in asset.file.url|lower %}
                            <video controls class="w-full h-auto">
                                <source src="{{ asset.file.url }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {% else %}
                            <p class="p-4 text-center text-gray-500">Cannot preview this file type.</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Tombol Aksi -->
    <div class="mt-8 pt-6 border-t flex justify-end items-center space-x-4">
        <a href="{% url 'schedule_list' %}" class="px-6 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">Cancel</a>
        <form action="{% url 'process_schedule' schedule.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="px-8 py-2 font-semibold text-white bg-indigo-600 rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Confirm & Schedule
            </button>
        </form>
    </div>
</div>
{% endblock %}